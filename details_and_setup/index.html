<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Jonathan Hanson">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Operational Overview and Setup - Certificate Authority Guide</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Operational Overview and Setup";
    var mkdocs_page_input_path = "details_and_setup.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/bash.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Certificate Authority Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Operational Overview and Setup</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-a-docker-working-environment">Setting Up a Docker Working Environment</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#verifying-the-environment">Verifying the Environment</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../generating_ca/">Generating a Certificate Authority</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../distribution/">Root Certificate Distribution</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../service_certificates/">Service Certificates</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../revocation_certificates/">Revoking Certificates</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../references/">References</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Certificate Authority Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Operational Overview and Setup</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/triplepoint/certificate-authority-guide/blob/master/mkdocs/docs/details_and_setup.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="operational-overview">Operational Overview</h1>
<p>The <a href="https://www.openssl.org/docs/man1.1.1/man1/openssl.html">OpenSSL command line tool</a> is the intimidating Swiss Army knife that performs practically all of the functions necessary for running a CA.  We'll only use a fraction of its features for this project.</p>
<p>In addition to generating keys and certificates and handling signing requests, OpenSSL can maintain a database of all the issued certificates signed by the CA.  Also, an incrementing serial number for issued certs can be kept to aid in auditing.  The database of issued certs and the serial number state are stored in text files alongside the certificates they describe, and these files will need to be preserved together with the CA certificates.</p>
<p>To do so, we'll generate one archive of the entire CA working set (<code>ca_authority.tar.gz</code>), and another for just the subset of files defining the intermediate certificate (<code>intermediate_authority.tar.gz</code>).  These archives can then be stored in separate safe locations between uses, allowing the less-risky intermediate authority certificate to be used to sign service certificates, without having to risk frequent access to the more dangerous root certificate.</p>
<h2 id="setting-up-a-docker-working-environment">Setting Up a Docker Working Environment</h2>
<p>In order to provide a self-contained repeatable infrastructure for operating the CA, we'll use Docker containers with the necessary tools pre-installed.  These short-lived containers can be destroyed and regenerated between CA duties, <em>as long as we're careful to archive the work done at the end of each session</em>.  We'll cover the details of doing so later in this guide.</p>
<p>Setting up a Docker host environment on your computer is beyond the scope of this document, but it's not especially difficult.  A good place to start is the <a href="https://www.docker.com/community-edition">Docker Community Edition website</a>.</p>
<p>Once you've got Docker installed, clone this site's code repository to a working directory:</p>
<pre><code class="language-bash">git clone https://github.com/triplepoint/certificate-authority-guide

cd certificate-authority-guide/src
</code></pre>
<p>Then with the provided helper script, build the <a href="https://github.com/triplepoint/certificate-authority-guide/blob/master/src/Dockerfile"><code>Dockerfile</code></a> into a Docker image and launch a Docker instance from that image:</p>
<pre><code class="language-bash">./scripts/run
</code></pre>
<p>If you inspect the above <code>run</code> script, in the <code>docker run</code> command, the <code>--mount</code> parameter is defining a local <code>source</code> directory (<code>./archives</code>) to mount as <code>/root/ca_persist</code> inside the Docker container.  This directory, shared between the host machine and the Docker container, is how we'll preserve the CA archives after we terminate the container.</p>
<p>When the above command is run, you'll have a Bash shell into that new container, in the container's <code>/root/ca</code> directory.  This is the working directory in which all the CA management work will take place.  The idea is that whatever work happens in here can be archived and moved (within the container) to <code>/root/ca_persist</code>, which will preserve it on the host machine after the container is terminated.</p>
<p>If the shared mount directory already has the <code>ca_authority.tar.gz</code> and/or <code>intermediate_authority.tar.gz</code> files present when the container is created, then these pre-existing archives will be unpacked into the <code>/root/ca</code> working directory on the Docker container when the container is created.  If both these archives are missing, then a new skeleton directory structure will be prepared.  Note that the root CA authority archive also contains the contents of the intermediate CA authority archive, and if both archive files are present in the shared mount, the root CA authority will take precedence.  See the Docker image's <a href="https://github.com/triplepoint/certificate-authority-guide/blob/master/src/scripts/entrypoint.sh"><code>entrypoint.sh</code></a> file for more details about what happens when the Docker container is created.</p>
<p>Remember, it's your responsibility to ensure that new work done inside the Docker container is archived <em>before</em> the container is exited and destroyed.  We'll explain more about how to do this later in this guide.</p>
<p>Note that in the <code>run</code> script above, we're creating a local <code>./archives</code> directory to use as the <code>source</code> archive directory on the host.  You could instead provide the path to a mounted USB drive and avoid copying the archives onto your computer.  Be aware that Docker requires that path to be an absolute path.</p>
<p>Be sure not to omit the <code>--rm</code> flag; this container will generate confidential files, and we want to destroy it once we're done working inside the container and have safely re-created the archives.</p>
<h2 id="verifying-the-environment">Verifying the Environment</h2>
<p>Before we move on to setting up our Certificate Authority, go ahead and run the commands above and ensure that you've got a command prompt inside the Docker container.  You can verify things are set up properly by running the <code>pwd</code> and <code>tree</code> commands to see which directory you're in, and whether the skeleton root CA authority is set up:</p>
<pre><code class="language-bash">root@b802e56f10b6:~/ca# pwd
/root/ca
root@b802e56f10b6:~/ca# tree
.
|-- ca_openssl.cnf
|-- certs
|-- crl
|-- crlnumber
|-- csr
|-- index.txt
|-- intermediate
|   |-- ca_openssl.cnf
|   |-- certs
|   |-- crl
|   |-- crlnumber
|   |-- csr
|   |-- index.txt
|   |-- newcerts
|   |-- private
|   `-- serial
|-- newcerts
|-- private
`-- serial

11 directories, 8 files
</code></pre>
<p>Unless specified otherwise, the commands in the rest of this guide are executed inside the context of this Docker image.</p>
<p>At any point you can run <code>exit</code> to leave the docker container and destroy it.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../generating_ca/" class="btn btn-neutral float-right" title="Generating a Certificate Authority">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/triplepoint/certificate-authority-guide/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../generating_ca/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
